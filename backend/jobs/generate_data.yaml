# HF Jobs: Synthetic Data Generation
# Generates training pairs for compliance extraction

name: redline-generate-data
description: Generate synthetic policyâ†’JSON training pairs for weak categories

compute:
  accelerator: gpu
  gpu_type: nvidia-l4
  gpu_count: 1
  max_duration_seconds: 3600

image: python:3.12-slim

env:
  GEMINI_API_KEY: "${GEMINI_API_KEY}"
  HF_TOKEN: "${HF_TOKEN}"
  TARGET_COUNT: "${TARGET_COUNT:-510}"
  WORKERS: "${WORKERS:-15}"
  DATASET_REPO: "${DATASET_REPO:-mistral-hackaton-2026/redline-compliance-extraction}"
  CODE_REPO_URL: "${CODE_REPO_URL:-https://huggingface.co/mistral-hackaton-2026/redline-extractor}"

setup: |
  pip install google-genai jsonschema huggingface-hub gitpython

  # Clone backend code to get generation script and schema
  git clone "${CODE_REPO_URL}" /workspace/repo || true
  if [ -d "/workspace/repo/backend" ]; then
    cp -r /workspace/repo/backend /workspace/backend
  fi

command: |
  cd /workspace/backend
  python data/generation_script.py \
    --target-count "${TARGET_COUNT}" \
    --workers "${WORKERS}" \
    --resume \
    --output-dir /outputs/data

artifacts:
  output:
    path: /outputs/data
    push_to_hub:
      repo_id: "${DATASET_REPO}"
      repo_type: dataset
